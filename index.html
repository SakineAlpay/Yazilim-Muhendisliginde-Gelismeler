<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnHub - Modern ƒ∞ngilizce Platformu</title>
    <style>
        /* CSS Kodlarƒ±n Aynƒ± Kalacak, Yer Kaplamamasƒ± ƒ∞√ßin Kƒ±saltƒ±yorum */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #667eea; --secondary: #764ba2; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --dark: #1f2937; --light: #f9fafb; --border: #e5e7eb; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .app-container { display: flex; height: 100vh; }
        .auth-wrapper { width: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-box { background: white; padding: 50px; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); width: 480px; max-width: 100%; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h1 { font-size: 36px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .logo p { color: #6b7280; font-size: 14px; }
        .security-badge { display: inline-flex; align-items: center; gap: 5px; background: #fef3c7; color: #92400e; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-top: 10px; }
        .auth-tabs { display: flex; gap: 10px; margin-bottom: 30px; background: #f3f4f6; padding: 6px; border-radius: 12px; }
        .auth-tab { flex: 1; padding: 12px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; color: #6b7280; }
        .auth-tab.active { background: white; color: var(--primary); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px; }
        .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 15px; transition: all 0.3s; background: #fafafa; }
        .form-group input:focus { outline: none; border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .btn-secondary:hover { background: #e5e7eb; }
        .message { padding: 14px; border-radius: 10px; margin-top: 15px; display: none; font-size: 14px; font-weight: 500; }
        .message.success { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .message.error { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        .form-section { display: none; }
        .form-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .sidebar { width: 280px; background: white; box-shadow: 4px 0 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow-y: auto; }
        .sidebar-header { padding: 30px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .sidebar-header h2 { font-size: 24px; margin-bottom: 5px; }
        .sidebar-header p { font-size: 14px; opacity: 0.9; }
        .user-info { padding: 20px; border-bottom: 1px solid var(--border); }
        .user-avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; margin-bottom: 15px; }
        .user-name { font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 5px; }
        .user-level { display: inline-block; padding: 4px 12px; background: #dbeafe; color: #1e40af; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .nav-menu { flex: 1; padding: 10px; }
        .nav-item { padding: 14px 16px; margin-bottom: 6px; border-radius: 10px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 12px; color: #6b7280; font-weight: 500; }
        .nav-item:hover { background: #f3f4f6; color: var(--primary); }
        .nav-item.active { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .nav-icon { font-size: 20px; }
        .nav-badge { margin-left: auto; background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; }
        .logout-section { padding: 20px; border-top: 1px solid var(--border); }
        .main-content { flex: 1; overflow-y: auto; padding: 40px; background: #f9fafb; }
        .content-header { margin-bottom: 30px; }
        .content-header h1 { font-size: 32px; color: var(--dark); margin-bottom: 8px; }
        .content-header p { color: #6b7280; font-size: 16px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 24px; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-icon.blue { background: #dbeafe; color: #1e40af; }
        .stat-icon.green { background: #d1fae5; color: #065f46; }
        .stat-icon.purple { background: #e9d5ff; color: #6b21a8; }
        .stat-icon.orange { background: #fed7aa; color: #9a3412; }
        .stat-value { font-size: 36px; font-weight: 700; color: var(--dark); margin-bottom: 4px; }
        .stat-label { color: #6b7280; font-size: 14px; }
        .card { background: white; padding: 24px; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border); }
        .card-title { font-size: 20px; font-weight: 700; color: var(--dark); }
        .word-item { padding: 20px; background: #f9fafb; border-radius: 12px; margin-bottom: 12px; border-left: 4px solid var(--primary); transition: all 0.3s; }
        .word-item:hover { transform: translateX(4px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .word-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .word-title { font-size: 22px; font-weight: 700; color: var(--dark); }
        .word-level { padding: 6px 14px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .word-meaning { color: #6b7280; margin-bottom: 8px; font-size: 15px; }
        .btn-sm { padding: 8px 16px; font-size: 13px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-learn { background: var(--success); color: white; }
        .btn-learn:hover { background: #059669; transform: scale(1.05); }
        .token-display { background: #fef3c7; border: 2px solid #fbbf24; padding: 16px; border-radius: 12px; margin-bottom: 20px; font-size: 13px; word-break: break-all; }
        .token-display strong { color: #92400e; }
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 10px; transition: width 0.5s ease; }
        .empty-state { text-align: center; padding: 60px 20px; color: #9ca3af; }
        .empty-state-icon { font-size: 64px; margin-bottom: 16px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }
        .hidden { display: none !important; }
        @media (max-width: 768px) { .sidebar { width: 240px; } .main-content { padding: 20px; } .stats-grid { grid-template-columns: 1fr; } }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f4f6; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="authSection" class="auth-wrapper">
        <div class="auth-box">
            <div class="logo">
                <h1>üéì LearnHub</h1>
                <p>Modern ƒ∞ngilizce √ñƒürenme Platformu</p>
                <div class="security-badge">
                    üîí JWT Secure Authentication
                </div>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">
                    Giri≈ü Yap
                </div>
                <div class="auth-tab" onclick="switchAuthTab('register')">
                    Kayƒ±t Ol
                </div>
            </div>
            
            <form id="loginForm" class="form-section active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="loginUsername" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    üîê Giri≈ü Yap
                </button>
                <div id="loginMessage" class="message"></div>
            </form>
            
            <form id="registerForm" class="form-section" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="regUsername" placeholder="Benzersiz bir kullanƒ±cƒ± adƒ± se√ßin" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="regPassword" placeholder="G√º√ßl√º bir ≈üifre olu≈üturun" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    ‚ú® Hesap Olu≈ütur
                </button>
                <div id="registerMessage" class="message"></div>
            </form>
        </div>
    </div>
    
    <div id="appContainer" class="app-container hidden">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üéì LearnHub</h2>
                <p>√ñƒürenmeye devam et!</p>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-name" id="userName">User</div>
                <div class="user-level" id="userLevel">A1</div>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showSection('words')">
                    <span class="nav-icon">üìö</span>
                    <span>Kelimeler</span>
                    <span class="nav-badge">üîí</span>
                </div>
                <div class="nav-item" onclick="showSection('grammar')">
                    <span class="nav-icon">üìù</span>
                    <span>Dilbilgisi</span>
                    <span class="nav-badge">üîí</span>
                </div>
                <div class="nav-item" onclick="showSection('tests')">
                    <span class="nav-icon">‚úÖ</span>
                    <span>Testler</span>
                    <span class="nav-badge">üîí</span>
                </div>
                <div class="nav-item" onclick="showSection('stats')">
                    <span class="nav-icon">üìà</span>
                    <span>ƒ∞statistikler</span>
                    <span class="nav-badge">üîí</span>
                </div>
                <div class="nav-item" onclick="showSection('scoreboard')">
                    <span class="nav-icon">üèÜ</span>
                    <span>Skor Tahtasƒ±</span>
                </div>
                <div class="nav-item" onclick="showSection('friends')">
                    <span class="nav-icon">üë•</span>
                    <span>Arkada≈ülar</span>
                    <span class="nav-badge">üîí</span>
                </div>
            </nav>
            
            <div class="logout-section">
                <button class="btn btn-secondary" onclick="handleLogout()">
                    üö™ √áƒ±kƒ±≈ü Yap
                </button>
            </div>
        </aside>
        
        <main class="main-content">
         <div id="dashboardSection" class="section active">
                <div class="content-header">
                    <h1>Ho≈ü Geldin, <span id="dashboardUserName">User</span>! üëã</h1>
                    <p>√ñƒürenme yolculuƒüuna devam etmeye hazƒ±r mƒ±sƒ±n?</p>
                </div>
                
                <div class="token-display">
                    <strong>üîê JWT Token:</strong> <span id="tokenDisplay">Y√ºkleniyor...</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">üìö</div>
                        </div>
                        <div class="stat-value" id="dashWordsLearned">0</div>
                        <div class="stat-label">√ñƒürenilen Kelime</div>
                        <div class="progress-bar">
                            <div id="barWords" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">‚úÖ</div>
                        </div>
                        <div class="stat-value" id="dashTestsTaken">0</div>
                        <div class="stat-label">Tamamlanan Test</div>
                        <div class="progress-bar">
                             <div id="barTests" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon purple">üî•</div>
                        </div>
                        <div class="stat-value" id="dashStreakDays">0</div>
                        <div class="stat-label">G√ºnl√ºk Seri</div>
                        <div class="progress-bar">
                             <div id="barStreak" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">‚è±Ô∏è</div>
                        </div>
                        <div class="stat-value" id="dashStudyTime">0</div>
                        <div class="stat-label">√áalƒ±≈üma Dakikasƒ±</div>
                        <div class="progress-bar">
                             <div id="barTime" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéØ Bug√ºnk√º Hedefler</div>
                    </div>
                    <div style="padding: 20px; text-align: center; color: #9ca3af;">
                        <p>‚ú® 5 yeni kelime √∂ƒüren</p>
                        <p>üìù 1 dilbilgisi quizi √ß√∂z</p>
                        <p>üî• Serine devam et!</p>
                    </div>
                </div>
            </div>
            
            <div id="wordsSection" class="section">
                <div class="content-header">
                    <h1>üìö Kelimeler</h1>
                    <p>Seviyene uygun kelimeleri √∂ƒüren ve pratik yap</p>
                </div>
                
                <div id="wordsList" class="card">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <div id="grammarSection" class="section">
                <div class="content-header">
                    <h1>üìù Dilbilgisi Konularƒ±</h1>
                    <p>Konularƒ± √ßalƒ±≈ü ve tamamlandƒ± olarak i≈üaretle.</p>
                </div>
                <div id="grammarList" class="stats-grid">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <div id="testsSection" class="section">
                <div class="content-header">
                    <h1>‚úÖ ƒ∞ngilizce Seviye Testi</h1>
                    <p>Kendini dene! Bakalƒ±m ka√ß doƒürun √ßƒ±kacak?</p>
                </div>
                
                <div class="card">
                    <form id="testForm" onsubmit="submitTest(event)">
                        <div id="questionsContainer">
                            <div class="spinner"></div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-primary">
                                üìù Testi Bitir ve G√∂nder
                            </button>
                        </div>
                    </form>
                    <div id="testResult" class="message" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div id="testsSection" class="section">
                <div class="content-header">
                    <h1>‚úÖ Testler</h1>
                    <p>Bilgilerini test et ve ilerlemeni √∂l√ß</p>
                </div>
                
                <div class="card">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <p>Test mod√ºl√º yakƒ±nda eklenecek!</p>
                    </div>
                </div>
            </div>
            
            <div id="statsSection" class="section">
                <div class="content-header">
                    <h1>üìà ƒ∞statistiklerim</h1>
                    <p>Detaylƒ± √∂ƒürenme analizin</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üìö</div>
                        <div class="stat-value" id="statsWordsLearned">0</div>
                        <div class="stat-label">√ñƒürenilen Kelime</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon green">üìñ</div>
                        <div class="stat-value" id="statsGrammarCompleted">0</div>
                        <div class="stat-label">Dilbilgisi Konusu</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon purple">‚úÖ</div>
                        <div class="stat-value" id="statsTestsTaken">0</div>
                        <div class="stat-label">Tamamlanan Test</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon orange">‚è±Ô∏è</div>
                        <div class="stat-value" id="statsStudyTime">0 dk</div>
                        <div class="stat-label">Toplam √áalƒ±≈üma</div>
                    </div>
                </div>
            </div>
            
          <div id="scoreboardSection" class="section">
                <div class="content-header">
                    <h1>üèÜ Skor Tahtasƒ±</h1>
                    <p>En √ßalƒ±≈ükan √∂ƒürenciler burada! Zirveye √ßƒ±kmak i√ßin bol bol test √ß√∂z.</p>
                </div>
                
                <div id="scoreboardList" class="card" style="padding: 10px;">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <div id="friendsSection" class="section">
                <div class="content-header">
                    <h1>üë• Arkada≈ülar</h1>
                </div>
                <div class="card">
                     <div class="empty-state">
                        <p>Arkada≈ü listesi yakƒ±nda y√ºklenecek.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // API Adresi (Backend'in √ßalƒ±≈ütƒ±ƒüƒ± adres)
        // NOT: Buraya sadece k√∂k adresi yazƒ±yoruz, endpointleri fetch i√ßinde ekleyeceƒüiz.
        const API_URL = "http://localhost:8000";

        // Sayfa Y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            if (token) {
                showApp();
                fetchUserData();
            }
        });

        // Tab Deƒüi≈ütirme (Giri≈ü / Kayƒ±t)
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(f => f.classList.remove('active'));

            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        // --- KAYIT OL (REGISTER) ---
        async function handleRegister(event) {
            event.preventDefault();
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const msgDiv = document.getElementById('registerMessage');

            try {
                // D√úZELTME BURADA: Backend'deki tam adresi yazdƒ±k (/api/auth/register)
                const response = await fetch(`${API_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    msgDiv.className = 'message success';
                    msgDiv.innerText = 'Kayƒ±t ba≈üarƒ±lƒ±! ≈ûimdi giri≈ü yapabilirsin.';
                    msgDiv.style.display = 'block';
                    setTimeout(() => switchAuthTab('login'), 2000);
                } else {
                    throw new Error(data.detail || data.message || 'Kayƒ±t ba≈üarƒ±sƒ±z.');
                }
            } catch (error) {
                msgDiv.className = 'message error';
                msgDiv.innerText = error.message;
                msgDiv.style.display = 'block';
            }
        }

        // --- Gƒ∞Rƒ∞≈û YAP (LOGIN) ---
        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const msgDiv = document.getElementById('loginMessage');

            try {
                // D√úZELTME BURADA: Backend'deki tam adresi yazdƒ±k (/api/auth/login)
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.message || 'Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±.');
                
                // Token'ƒ± kaydet
                localStorage.setItem('token', data.token); // Backend 'token' olarak d√∂n√ºyor
                localStorage.setItem('username', username);
                
                msgDiv.className = 'message success';
                msgDiv.innerText = 'Giri≈ü ba≈üarƒ±lƒ±! Y√∂nlendiriliyorsunuz...';
                msgDiv.style.display = 'block';

                setTimeout(() => {
                    showApp();
                    fetchUserData();
                }, 1000);

            } catch (error) {
                msgDiv.className = 'message error';
                msgDiv.innerText = error.message;
                msgDiv.style.display = 'block';
            }
        }

        // Uygulama Ekranƒ±nƒ± G√∂ster
        function showApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            const username = localStorage.getItem('username');
            document.getElementById('userName').innerText = username;
            document.getElementById('dashboardUserName').innerText = username;
            document.getElementById('userAvatar').innerText = username.charAt(0).toUpperCase();
            
            const token = localStorage.getItem('token');
            document.getElementById('tokenDisplay').innerText = token ? token.substring(0, 20) + "..." : "Yok";
        }

        // --- VERƒ∞ √áEKME (WORDS) ---
        async function fetchWords() {
            const listDiv = document.getElementById('wordsList');
            listDiv.innerHTML = '<div class="spinner"></div>';
            
            try {
                const token = localStorage.getItem('token');
                // D√úZELTME BURADA: Backend'deki tam adresi yazdƒ±k (/api/words)
                const response = await fetch(`${API_URL}/api/words`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.status === 401) {
                    handleLogout();
                    return;
                }

                const result = await response.json();
                const words = result.words; // Backend {success: true, words: [...]} d√∂n√ºyor
                
                if (!words || words.length === 0) {
                    listDiv.innerHTML = '<div class="empty-state"><p>Hen√ºz kelime eklenmemi≈ü.</p></div>';
                    return;
                }

                let html = '';
                words.forEach(word => {
                    html += `
                    <div class="word-item">
                        <div class="word-header">
                            <span class="word-title">${word.word}</span>
                            <span class="word-level">${word.level}</span>
                        </div>
                        <div class="word-meaning">${word.meaning}</div>
                        <div class="word-example">"${word.example}"</div>
                        <div class="word-actions">
                            <button class="btn-sm btn-learn" onclick="markAsLearned(${word.id})">√ñƒürenildi ƒ∞≈üaretle</button>
                        </div>
                    </div>`;
                });
                listDiv.innerHTML = html;
                
                document.getElementById('dashWordsLearned').innerText = words.length;
                document.getElementById('statsWordsLearned').innerText = words.length;

            } catch (error) {
                console.error(error);
                listDiv.innerHTML = '<div class="message error">Kelimeler y√ºklenemedi. API baƒülantƒ±sƒ±nƒ± kontrol et.</div>';
            }
        }

        // B√∂l√ºm Deƒüi≈ütirme (Sidebar)
        // B√∂l√ºm Deƒüi≈ütirme Fonksiyonunu Bununla Deƒüi≈ütir
       // Men√º Ge√ßi≈ü Fonksiyonu (BUNU KOPYALA VE ESKƒ∞Sƒ∞YLE DEƒûƒ∞≈ûTƒ∞R)
        function showSection(sectionId) {
            // ... (diƒüer kodlar aynƒ±) ...
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if(event && event.currentTarget) event.currentTarget.classList.add('active');
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) targetSection.classList.add('active');

            // --- YENƒ∞ EKLENENLER ---
            if (sectionId === 'words') fetchWords();
            if (sectionId === 'grammar') fetchGrammar();
            if (sectionId === 'tests') fetchTests();
            if (sectionId === 'scoreboard') fetchScoreboard();
            if (sectionId === 'friends') fetchFriends(); // <-- BUNU EKLE
        }

        // √áƒ±kƒ±≈ü Yap
        function handleLogout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            location.reload();
        }

      // --- KULLANICI ƒ∞STATƒ∞STƒ∞KLERƒ∞Nƒ∞ VE √áUBUKLARI G√úNCELLE ---
        async function fetchUserData() {
            const username = localStorage.getItem('username');
            const token = localStorage.getItem('token');

            if (!username || !token) return;

            // 1. Kelimeleri √áek (Listeyi doldurmak i√ßin)
            fetchWords(); 
            
            // 2. ƒ∞statistikleri √áek (√áubuklarƒ± doldurmak i√ßin)
            try {
                const response = await fetch(`${API_URL}/api/stats/${username}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats;

                    // Sayƒ±larƒ± G√ºncelle
                    document.getElementById('dashWordsLearned').innerText = stats.words_learned;
                    document.getElementById('dashTestsTaken').innerText = stats.tests_taken;
                    document.getElementById('dashStreakDays').innerText = stats.study_streak_days;
                    document.getElementById('dashStudyTime').innerText = stats.total_study_time_minutes;

                    // --- ƒ∞LERLEME √áUBUKLARINI HESAPLA ---
                    // Hedefleri kafamƒ±zdan belirledik (Gamification mantƒ±ƒüƒ±)
                    
                    // 1. Hedef: 50 Kelime
                    const wordPercent = Math.min((stats.words_learned / 50) * 100, 100);
                    document.getElementById('barWords').style.width = `${wordPercent}%`;

                    // 2. Hedef: 20 Test
                    const testPercent = Math.min((stats.tests_taken / 20) * 100, 100);
                    document.getElementById('barTests').style.width = `${testPercent}%`;

                    // 3. Hedef: 30 G√ºnl√ºk Seri
                    const streakPercent = Math.min((stats.study_streak_days / 30) * 100, 100);
                    document.getElementById('barStreak').style.width = `${streakPercent}%`;

                    // 4. Hedef: 1000 Dakika √áalƒ±≈üma
                    const timePercent = Math.min((stats.total_study_time_minutes / 1000) * 100, 100);
                    document.getElementById('barTime').style.width = `${timePercent}%`;
                }
            } catch (error) {
                console.error("ƒ∞statistik hatasƒ±:", error);
            }
        }

        // --- Dƒ∞LBƒ∞LGƒ∞Sƒ∞ √áEKME (GRAMMAR) ---
        async function fetchGrammar() {
            const listDiv = document.getElementById('grammarList');
            listDiv.innerHTML = '<div class="spinner"></div>';
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/grammar`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                const topics = result.topics;

                if (!topics || topics.length === 0) {
                    listDiv.innerHTML = '<div class="empty-state"><p>Konu bulunamadƒ±.</p></div>';
                    return;
                }

                let html = '';
                topics.forEach(topic => {
                    html += `
                    <div class="stat-card" style="border-left: 5px solid #764ba2; margin-bottom: 15px;">
                        <div class="word-header">
                            <span class="word-title" style="font-size: 18px;">${topic.topic}</span>
                            <span class="word-level">${topic.level}</span>
                        </div>
                        <p style="color: #666; margin: 10px 0;">${topic.explanation}</p>
                        <button class="btn-sm btn-secondary" onclick="completeGrammarTopic('${topic.topic}')">
                            ‚úÖ Konuyu Tamamla
                        </button>
                    </div>`;
                });
                listDiv.innerHTML = html;
                
                if(result.user) {
                   const count = topics.length; // Basit g√∂sterim
                   // ƒ∞statistik g√ºncellemesi backend'den gelmeli ama ≈üimdilik manuel:
                   document.getElementById('statsGrammarCompleted').innerText = count; 
                }

            } catch (error) {
                console.error(error);
                listDiv.innerHTML = '<div class="message error">Konular y√ºklenemedi.</div>';
            }
        }

        // Dilbilgisi Konusu Tamamlama
        async function completeGrammarTopic(topicName) {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/api/grammar/quiz`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if(response.ok) {
                    alert(`"${topicName}" konusu tamamlandƒ±! Puan kazandƒ±n.`);
                    fetchUserData(); // ƒ∞statistikleri yenile
                }
            } catch(e) { console.error(e); }
        }

        // --- TESTLERƒ∞ √áEKME ---
        async function fetchTests() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '<div class="spinner"></div>';

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/tests`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                const tests = result.tests;

                if (!tests || tests.length === 0) {
                    container.innerHTML = '<p>≈ûu an aktif test yok.</p>';
                    return;
                }

                let html = '';
                tests.forEach(test => {
                    html += `
                    <div class="form-group" style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <label style="font-size: 16px; margin-bottom: 10px; display:block; font-weight:bold;">${test.id}. ${test.question}</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${test.options.map(opt => `
                                <label style="font-weight: normal; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="q_${test.id}" value="${opt}" required>
                                    ${opt}
                                </label>
                            `).join('')}
                        </div>
                    </div>`;
                });
                container.innerHTML = html;

            } catch (error) {
                console.error(error);
                container.innerHTML = '<div class="message error">Test sorularƒ± y√ºklenemedi.</div>';
            }
        }

        // --- TEST G√ñNDERME ---
        async function submitTest(event) {
            event.preventDefault();
            const token = localStorage.getItem('token');
            const resultDiv = document.getElementById('testResult');
            
            const formData = new FormData(event.target);
            const answers = [];
            
            for (const [key, value] of formData.entries()) {
                if (key.startsWith('q_')) {
                    const id = parseInt(key.split('_')[1]);
                    answers.push({ id: id, user_answer: value });
                }
            }

            try {
                const response = await fetch(`${API_URL}/api/tests/submit`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ answers: answers })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'message success';
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = `
                        <h3 style="margin-bottom:10px;">üéâ Test Sonucu</h3>
                        <p>Doƒüru Cevap: <strong>${data.correct_answers} / ${data.total_questions}</strong></p>
                        <p>Skorun: ${data.score}</p>
                        <p>${data.feedback}</p>
                    `;
                    // ƒ∞statistikleri g√ºncelle
                    if(data.stats) {
                        document.getElementById('dashTestsTaken').innerText = data.stats.tests_taken;
                        document.getElementById('statsTestsTaken').innerText = data.stats.tests_taken;
                    }
                }
            } catch (error) {
                resultDiv.className = 'message error';
                resultDiv.innerText = 'Test g√∂nderilemedi.';
                resultDiv.style.display = 'block';
            }
        }

        // G√úNCELLENMƒ∞≈û MEN√ú GE√áƒ∞≈û FONKSƒ∞YONU
        // (Eski showSection fonksiyonunu ezecek, en alta koyduƒüun i√ßin bu √ßalƒ±≈üƒ±r)
        function showSection(sectionId) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if(event && event.currentTarget) event.currentTarget.classList.add('active');

            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }

            if (sectionId === 'words') fetchWords();
            if (sectionId === 'grammar') fetchGrammar();
            if (sectionId === 'tests') fetchTests();
        }

        // --- SKOR TAHTASINI GETƒ∞R ---
        async function fetchScoreboard() {
            const listDiv = document.getElementById('scoreboardList');
            listDiv.innerHTML = '<div class="spinner"></div>';
            
            try {
                // Backend'de bu endpoint token istemiyor (public), o y√ºzden direkt √ßekiyoruz
                const response = await fetch(`${API_URL}/api/scoreboard`);
                const users = await response.json();
                
                if (users.length === 0) {
                    listDiv.innerHTML = '<div class="empty-state"><p>Hen√ºz kimse puan kazanmamƒ±≈ü.</p></div>';
                    return;
                }

                let html = '';
                users.forEach((user, index) => {
                    // ƒ∞lk 3 ki≈üiye √∂zel stil belirleyelim
                    let rankClass = '';
                    let rankContent = index + 1;
                    
                    if (index === 0) { 
                        rankClass = 'gold'; 
                        rankContent = 'ü•á'; 
                    } else if (index === 1) { 
                        rankClass = 'silver'; 
                        rankContent = 'ü•à'; 
                    } else if (index === 2) { 
                        rankClass = 'bronze'; 
                        rankContent = 'ü•â'; 
                    }

                    html += `
                    <div class="scoreboard-item">
                        <div class="rank ${rankClass}">${rankContent}</div>
                        
                        <div class="user-avatar" style="width: 40px; height: 40px; font-size: 16px; margin: 0 15px 0 0; background: linear-gradient(135deg, #667eea, #764ba2);">
                            ${user.username.charAt(0).toUpperCase()}
                        </div>
                        
                        <div class="user-details">
                            <strong>${user.username}</strong>
                            <div style="font-size: 12px; color: #6b7280;">Seviye: ${user.level}</div>
                        </div>
                        
                        <div class="score-value">${user.score} P</div>
                    </div>`;
                });
                
                listDiv.innerHTML = html;

            } catch (error) {
                console.error(error);
                listDiv.innerHTML = '<div class="message error">Skor tablosu y√ºklenemedi.</div>';
            }
        }

        // --- ARKADA≈ûLARI GETƒ∞R ---
        async function fetchFriends() {
            const listDiv = document.getElementById('friendsSection').querySelector('.card');
            listDiv.innerHTML = '<div class="spinner"></div>';

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/social/friends`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const friends = await response.json();

                if (friends.length === 0) {
                    listDiv.innerHTML = '<div class="empty-state"><p>Hen√ºz arkada≈üƒ±n yok. Sosyalle≈üme zamanƒ±!</p></div>';
                    return;
                }

                let html = '<h3>Arkada≈ülarƒ±m</h3>';
                friends.forEach(friend => {
                    html += `
                    <div class="scoreboard-item">
                        <div class="user-avatar" style="background:#10b981; margin-right:15px;">${friend.username.charAt(0).toUpperCase()}</div>
                        <div class="user-details">
                            <strong>${friend.username}</strong>
                            <div style="font-size:12px; color:#666;">${friend.score} Puan</div>
                        </div>
                        <button class="btn-sm btn-secondary">Mesaj</button>
                    </div>`;
                });
                listDiv.innerHTML = html;

            } catch (error) {
                listDiv.innerHTML = '<div class="message error">Arkada≈ülar y√ºklenemedi.</div>';
            }
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnHub - Modern ƒ∞ngilizce Platformu</title>
    <style>
        /* CSS STƒ∞LLERƒ∞ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #667eea; --secondary: #764ba2; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --dark: #1f2937; --light: #f9fafb; --border: #e5e7eb; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .app-container { display: flex; height: 100vh; }
        
        /* Auth */
        .auth-wrapper { width: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-box { background: white; padding: 50px; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); width: 480px; max-width: 100%; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h1 { font-size: 36px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .auth-tabs { display: flex; gap: 10px; margin-bottom: 30px; background: #f3f4f6; padding: 6px; border-radius: 12px; }
        .auth-tab { flex: 1; padding: 12px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; color: #6b7280; }
        .auth-tab.active { background: white; color: var(--primary); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 14px; }
        .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 15px; background: #fafafa; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .btn-sm { padding: 8px 16px; font-size: 13px; border-radius: 8px; border: none; cursor: pointer; color: white; background: var(--success); }
        .message { padding: 14px; border-radius: 10px; margin-top: 15px; display: none; font-size: 14px; font-weight: 500; }
        .message.success { background: #d1fae5; color: #065f46; border: 2px solid #10b981; }
        .message.error { background: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        .form-section { display: none; }
        .form-section.active { display: block; }
        
        /* Main App */
        .sidebar { width: 280px; background: white; display: flex; flex-direction: column; padding: 20px; }
        .user-info { margin-bottom: 30px; text-align: center; }
        .user-avatar { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 0 auto 10px; }
        .nav-item { padding: 12px; margin-bottom: 5px; border-radius: 10px; cursor: pointer; color: #666; display: flex; gap: 10px; align-items: center; }
        .nav-item:hover, .nav-item.active { background: #f3f4f6; color: var(--primary); font-weight: bold; }
        .main-content { flex: 1; padding: 40px; overflow-y: auto; background: #f9fafb; }
        .section { display: none; }
        .section.active { display: block; }
        .hidden { display: none !important; }
        
        /* Kartlar ve Gridler */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-value { font-size: 32px; font-weight: bold; color: var(--dark); }
        .progress-bar { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.5s; }
        
        /* Listeler */
        .scoreboard-item { display: flex; align-items: center; padding: 15px; background: white; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .rank { font-weight: bold; font-size: 20px; width: 40px; }
        .rank.gold { color: #f59e0b; } .rank.silver { color: #9ca3af; } .rank.bronze { color: #d97706; }
        .card { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; }
        
        /* Spinner */
        .spinner { width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="authSection" class="auth-wrapper">
        <div class="auth-box">
            <div class="logo">
                <h1>üéì LearnHub</h1>
                <p>ƒ∞ngilizce √ñƒürenme Platformu</p>
            </div>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">Giri≈ü Yap</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">Kayƒ±t Ol</div>
            </div>

            <form id="loginForm" class="form-section active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Giri≈ü Yap</button>
                <div id="loginMessage" class="message"></div>
            </form>

            <form id="registerForm" class="form-section" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="regUsername" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="regPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Hesap Olu≈ütur</button>
                <div id="registerMessage" class="message"></div>
            </form>
        </div>
    </div>

    <div id="appContainer" class="app-container hidden">
        <div class="sidebar">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <h3 id="userName">User</h3>
                <span id="userLevel" style="background:#dbeafe; color:#1e40af; padding:2px 8px; border-radius:10px; font-size:12px;">A1</span>
            </div>
            
            <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
            <div class="nav-item" onclick="showSection('words')">üìö Kelimeler</div>
            <div class="nav-item" onclick="showSection('grammar')">üìù Dilbilgisi</div>
            <div class="nav-item" onclick="showSection('tests')">‚úÖ Testler</div>
            <div class="nav-item" onclick="showSection('stats')">üìà ƒ∞statistikler</div>
            <div class="nav-item" onclick="showSection('scoreboard')">üèÜ Skor Tahtasƒ±</div>
            <div class="nav-item" onclick="showSection('friends')">üë• Arkada≈ülar</div>
            
            <div style="margin-top:auto;">
                <button class="btn btn-secondary" onclick="handleLogout()">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <main class="main-content">
            <div id="dashboardSection" class="section active">
                <h1 style="margin-bottom:20px;">Ho≈ü Geldin! üëã</h1>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">√ñƒürenilen Kelime</div>
                        <div class="stat-value" id="dashWordsLearned">0</div>
                        <div class="progress-bar"><div id="barWords" class="progress-fill" style="width:0%"></div></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Tamamlanan Test</div>
                        <div class="stat-value" id="dashTestsTaken">0</div>
                        <div class="progress-bar"><div id="barTests" class="progress-fill" style="width:0%"></div></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">G√ºnl√ºk Seri</div>
                        <div class="stat-value" id="dashStreakDays">0</div>
                        <div class="progress-bar"><div id="barStreak" class="progress-fill" style="width:0%"></div></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">√áalƒ±≈üma (Dk)</div>
                        <div class="stat-value" id="dashStudyTime">0</div>
                        <div class="progress-bar"><div id="barTime" class="progress-fill" style="width:0%"></div></div>
                    </div>
                </div>
            </div>

            <div id="wordsSection" class="section">
                <h1>üìö Kelimeler</h1>
                <div id="wordsList" style="margin-top:20px;"></div>
            </div>

            <div id="grammarSection" class="section">
                <h1>üìù Dilbilgisi Konularƒ±</h1>
                <div id="grammarList" class="stats-grid" style="margin-top:20px;"></div>
            </div>

            <div id="testsSection" class="section">
                <h1>‚úÖ Seviye Testi</h1>
                <div class="card" style="margin-top:20px;">
                    <form id="testForm" onsubmit="submitTest(event)">
                        <div id="questionsContainer"></div>
                        <button type="submit" class="btn btn-primary" style="margin-top:20px;">Testi G√∂nder</button>
                    </form>
                    <div id="testResult" class="message"></div>
                </div>
            </div>
            
             <div id="statsSection" class="section">
                <h1>üìà Detaylƒ± ƒ∞statistikler</h1>
                <div class="stats-grid" style="margin-top:20px;">
                    <div class="stat-card">
                        <div class="stat-label">Kelime</div>
                        <div class="stat-value" id="statsWordsLearned">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Test</div>
                        <div class="stat-value" id="statsTestsTaken">0</div>
                    </div>
                     <div class="stat-card">
                        <div class="stat-label">Dilbilgisi</div>
                        <div class="stat-value" id="statsGrammarCompleted">0</div>
                    </div>
                </div>
            </div>

            <div id="scoreboardSection" class="section">
                <h1>üèÜ Skor Tahtasƒ±</h1>
                <div id="scoreboardList" style="margin-top:20px;"></div>
            </div>

            <div id="friendsSection" class="section">
                <h1>üë• Arkada≈ülar</h1>
                <div class="card" style="margin-top:20px; background:#f0fdf4; display:flex; gap:10px;">
                    <input type="text" id="friendNameInput" placeholder="Kullanƒ±cƒ± adƒ± (√∂rn: user2)" style="padding:10px; border:1px solid #ddd; border-radius:8px; flex:1;">
                    <button class="btn-sm" onclick="addFriend()">Ekle</button>
                </div>
                <div id="friendsList" style="margin-top:20px;"></div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = "http://localhost:8000";

        document.addEventListener('DOMContentLoaded', () => {
            if(localStorage.getItem('token')) {
                showApp();
                fetchUserData();
            }
        });

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(f => f.classList.remove('active'));
            if(tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('loginUsername').value;
            const p = document.getElementById('loginPassword').value;
            try {
                const res = await fetch(`${API_URL}/api/auth/login`, {
                    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:u, password:p})
                });
                const data = await res.json();
                if(res.ok) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('username', u);
                    showApp();
                    fetchUserData();
                } else { alert(data.message); }
            } catch(err) { alert("Baƒülantƒ± hatasƒ±"); }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const u = document.getElementById('regUsername').value;
            const p = document.getElementById('regPassword').value;
            try {
                const res = await fetch(`${API_URL}/api/auth/register`, {
                    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:u, password:p})
                });
                if(res.ok) { alert("Kayƒ±t ba≈üarƒ±lƒ±! Giri≈ü yapƒ±n."); switchAuthTab('login'); }
                else { alert("Kayƒ±t ba≈üarƒ±sƒ±z."); }
            } catch(err) { alert("Hata olu≈ütu"); }
        }

        function showApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            const u = localStorage.getItem('username');
            document.getElementById('userName').innerText = u;
            document.getElementById('userAvatar').innerText = u.charAt(0).toUpperCase();
        }

        function handleLogout() {
            localStorage.clear();
            location.reload();
        }

        // --- MEN√ú GE√áƒ∞≈û VE VERƒ∞ √áEKME MERKEZƒ∞ ---
        function showSection(id) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(event && event.currentTarget) event.currentTarget.classList.add('active');
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id + 'Section').classList.add('active');

            if(id === 'words') fetchWords();
            if(id === 'grammar') fetchGrammar();
            if(id === 'tests') fetchTests();
            if(id === 'scoreboard') fetchScoreboard();
            if(id === 'friends') fetchFriends();
        }

        async function fetchUserData() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('username');
            try {
                const res = await fetch(`${API_URL}/api/stats/${user}`, { headers:{'Authorization':`Bearer ${token}`} });
                if(res.ok) {
                    const data = await res.json();
                    const s = data.stats;
                    
                    // ƒ∞statistikleri Yaz
                    document.getElementById('dashWordsLearned').innerText = s.words_learned;
                    document.getElementById('statsWordsLearned').innerText = s.words_learned;
                    
                    document.getElementById('dashTestsTaken').innerText = s.tests_taken;
                    document.getElementById('statsTestsTaken').innerText = s.tests_taken;
                    
                    document.getElementById('dashStreakDays').innerText = s.study_streak_days;
                    document.getElementById('dashStudyTime').innerText = s.total_study_time_minutes;
                    document.getElementById('statsGrammarCompleted').innerText = s.grammar_topics_completed;

                    // √áubuklarƒ± Doldur
                    document.getElementById('barWords').style.width = Math.min((s.words_learned/50)*100, 100) + '%';
                    document.getElementById('barTests').style.width = Math.min((s.tests_taken/20)*100, 100) + '%';
                    document.getElementById('barStreak').style.width = Math.min((s.study_streak_days/30)*100, 100) + '%';
                    document.getElementById('barTime').style.width = Math.min((s.total_study_time_minutes/1000)*100, 100) + '%';
                }
            } catch(e) { console.error(e); }
        }

        async function fetchWords() {
            const list = document.getElementById('wordsList');
            list.innerHTML = '<div class="spinner"></div>';
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/words`, { headers:{'Authorization':`Bearer ${token}`} });
            const data = await res.json();
            
            let html = '';
            data.words.forEach(w => {
                html += `<div style="background:white; padding:15px; margin-bottom:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05); border-left:4px solid #667eea;">
                    <h3>${w.word} <span style="font-size:12px; background:#eee; padding:3px 8px; border-radius:10px;">${w.level}</span></h3>
                    <p>${w.meaning}</p>
                    <small style="color:#666">"${w.example}"</small>
                </div>`;
            });
            list.innerHTML = html || 'Kelime yok.';
        }

        async function fetchGrammar() {
            const list = document.getElementById('grammarList');
            list.innerHTML = '<div class="spinner"></div>';
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/grammar`, { headers:{'Authorization':`Bearer ${token}`} });
            const data = await res.json();
            
            let html = '';
            data.topics.forEach(t => {
                html += `<div class="stat-card">
                    <h3>${t.topic}</h3>
                    <p>${t.explanation}</p>
                    <button class="btn-sm" style="margin-top:10px;" onclick="completeTopic()">Tamamla</button>
                </div>`;
            });
            list.innerHTML = html || 'Konu yok.';
        }
        
        async function completeTopic() {
             const token = localStorage.getItem('token');
             await fetch(`${API_URL}/api/grammar/quiz`, { method:'POST', headers:{'Authorization':`Bearer ${token}`} });
             alert("Konu tamamlandƒ±! +50 Puan");
             fetchUserData();
        }

        async function fetchTests() {
            const con = document.getElementById('questionsContainer');
            con.innerHTML = '<div class="spinner"></div>';
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/tests`, { headers:{'Authorization':`Bearer ${token}`} });
            const data = await res.json();
            
            let html = '';
            data.tests.forEach(t => {
                html += `<div style="margin-bottom:20px;">
                    <p style="font-weight:bold;">${t.question}</p>
                    ${t.options.map(o => `<label style="margin-right:15px;"><input type="radio" name="q_${t.id}" value="${o}" required> ${o}</label>`).join('')}
                </div>`;
            });
            con.innerHTML = html || 'Test yok.';
        }

        async function submitTest(e) {
            e.preventDefault();
            const fd = new FormData(e.target);
            const ans = [];
            for(let [k,v] of fd.entries()) if(k.startsWith('q_')) ans.push({id:parseInt(k.split('_')[1]), user_answer:v});
            
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/tests/submit`, {
                method:'POST', headers:{'Authorization':`Bearer ${token}`, 'Content-Type':'application/json'}, body:JSON.stringify({answers:ans})
            });
            const data = await res.json();
            document.getElementById('testResult').style.display='block';
            document.getElementById('testResult').innerHTML = `Sonu√ß: ${data.score} Puan! (${data.correct_answers} doƒüru)`;
            document.getElementById('testResult').className = 'message success';
            fetchUserData();
        }

        async function fetchScoreboard() {
            const list = document.getElementById('scoreboardList');
            list.innerHTML = '<div class="spinner"></div>';
            const res = await fetch(`${API_URL}/api/scoreboard`);
            const users = await res.json();
            
            let html = '';
            users.forEach((u, i) => {
                let rankColor = i===0 ? 'gold' : i===1 ? 'silver' : i===2 ? 'bronze' : 'black';
                let icon = i===0 ? 'ü•á' : i===1 ? 'ü•à' : i===2 ? 'ü•â' : `#${i+1}`;
                html += `<div class="scoreboard-item">
                    <span class="rank ${rankColor}" style="margin-right:10px;">${icon}</span>
                    <div style="flex:1;"><strong>${u.username}</strong> <small>(${u.level})</small></div>
                    <div style="font-weight:bold; color:#667eea;">${u.score} P</div>
                </div>`;
            });
            list.innerHTML = html || 'Veri yok.';
        }

        async function fetchFriends() {
            const list = document.getElementById('friendsList');
            list.innerHTML = '<div class="spinner"></div>';
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/social/friends`, { headers:{'Authorization':`Bearer ${token}`} });
            const friends = await res.json();
            
            let html = '';
            friends.forEach(f => {
                html += `<div class="scoreboard-item">
                    <div class="user-avatar" style="width:30px; height:30px; font-size:14px; margin-right:10px;">${f.username[0]}</div>
                    <div style="flex:1;"><strong>${f.username}</strong></div>
                    <div>${f.score} P</div>
                </div>`;
            });
            list.innerHTML = html || '<p style="text-align:center; color:#999;">Hen√ºz arkada≈üƒ±n yok.</p>';
        }

        async function addFriend() {
            const name = document.getElementById('friendNameInput').value;
            if(!name) return;
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_URL}/api/social/add_friend`, {
                method:'POST', headers:{'Authorization':`Bearer ${token}`, 'Content-Type':'application/json'}, body:JSON.stringify({friend_to_add:name})
            });
            const data = await res.json();
            alert(data.message);
            if(res.ok) { 
                document.getElementById('friendNameInput').value=''; 
                fetchFriends(); 
            }
        }
    </script>
</body>
</html>
